### Node.js

- 명령어 `node` => 노드가 실행된다.
- [node.js 공홈](https://nodejs.org/docs/latest/api/)

- 노드 프로세스는 멀티 스레드이지만 직접 다룰 수 있는 스레드는 하나이기 때문에 싱글 스레드라고 표현한다.
- 노드는 주로 멀티 스레드 대신 멀티 프로세스를 활용한다.
- 용어
  - 프로세스 : 운영체제에서 할당하는 직업의 단위, 프로세스 간 자원 공유x
  - 스레드 : 프로세스 내에서 실행되는 작업의 단위, 부모 프로세스 자원 공유o

---

- 서버로서의 노드
  - 노드는 서버가 아닌데 서버로 쓰일 수 있다. js로 서버 만드는 코딩을 하면 노드가 실행을 해줘서 내 컴퓨터가 서버 역할을 하게 해준다.
  - 노드 서버의 장단점
    <img src="./img/Screenshot 2024-05-08 at 1.21.08 PM.png" />
- 용어
  - 블로킹 : 순서대로(하나 끝나면 다음거 순으로) 실행된다.
  - 논 블로킹 : 순서대로 실행 안 된다. 동시적으로 실행된다.

---

##### 알아야할 JS 지식

- 프로미스

  - 콜백 헬이라고 불리는 지저분한 JS 코드의 해결책
  - 프로미스 : 내용이 실행은 되었지만 결과를 아직 반환하지 않은 객체
  - then을 붙이면 결과를 반환함
  - 실행이 완료되지 않았으면 완료된 후에 Then 내부 함수가 실행됨
  - resolve(성공 리턴값) => then으로 연결
  - reject(실패 리턴값) => catch로 연결
  - finally 부분은 무조건 실행된다.

    ```
    const condition = true

    const promise = new Promise((resolve, reject) => {
      if(condition) {
        resolve('성공')
      } else {
        reject('실패')
      }
    })

    // 다른 코드가 들어갈 수 있다.
    promise
      .then((message) => {
        console.log(message); // 성공(resolve)한 경우 실행
      })
      .catch((error) => {
        console.log(error) // 실패(reject)한 경우 실행
      })
    ```

- async/await
  - async 함수는 항상 promise를 반환한다.
    - then이나 await를 붙일 수 있다.
  - reject 처리를 위해 try-catch구문으로 감싸서 catch 부분에서 reject 처리를 해줘야 한다.

---

- commonJS 모듈 시스템

  - 파일 끝에 `module.exports`로 모듈로 만들 값을 지정
  - `module.exports`(`=== {빈 객체}`)는 파일에서 단 한번만 써야 한다.

    ```
    const odd = '홀수'
    const even = '짝수'

    module.exports = {
      odd, // exports.odd = odd 해도 된다.
      even
    }
    ```

    ```
    function checkOddOrEven() {
      ...
    }

    module.exports = checkOddOrEven;
    ```

  - 다른 파일에서 require(파일 경로)로 그 모듈의 내용 가져올 수 있음

    ```
    // 구조 분해 할당할때는 속성면이랑 변수명이랑 같아야 한다.
    const { odd, even } = require('./var');

    // 변수명을 마음대로 지을 수 있다.
    const checkNumber = require('./func')
    ```

  - `require`의 특성
    - require가 제일 위에 올 필요 없다.
    - require.cache에 한 번 require한 모듈에 대한 캐싱 정보가 들어있다.
    - require.main은 노드 실행 시 첫 모듈을 가리킨다.

  > require 함수나 module 객체는 따로 선언하지 않았음에도 노드에서 기본적으로 제공하는 내장 객체 이기 때문에 사용할 수 있다.

- ES module

  - `mjs` 확장자를 사용한다.
  - `mjs` 확장자 대신 `js` 확장자를 사용하고 싶다면 package.json에 "type": "module" 속성을 넣어주면 된다.

    ```
    // var.mjs
    export const odd = '홀수'
    export const even = '짝수'

    // func.mjs
    import {odd, even} from './var.mjs'

    function check(num) {
      ...
    }

    export default check

    // index.mjs
    import checkNumber from './func.mjs'

    ...
    ```

    <img src="./img/Screenshot 2024-05-08 at 7.26.36 PM.png"/>

> import 함수는 promise 이기 때문에 앞에 await을 붙인다.

---

- global 속성 공유
  - global에 속성 값을 대입하면 다른 파일에서도 사용 가능 (지양해야 한다.)
  - 터미널에 global을 치면 => node의 내장 객체를 알 수 있다.

---

process

- process.cwd() : 현재 스포세스가 실행되는 위치를 알려준다.
- node.js 에서는 setTimeout() 쓰지 말고, setImmediate()를 쓰자.
- process.uptime() : 노드의 실행 시간

---

os

- 운영체제의 정보를 담고 있다.
- require로 가져옴
- os.uptime() : 운영 체제 부팅 이후 흐른 시간(초)
- const path = require('path')
  - 폴더와 파일의 경로를 쉽게 조잡하도록 도와주는 모듈
    <img src="./img/Screenshot 2024-05-08 at 7.58.47 PM.png" />

---

<img src="./img/Screenshot 2024-05-08 at 8.41.06 PM.png" />
- searchParams : search 부분을 객체화 시켜둔 것이다.
- dns
  - 도메인을 통해 IP나 기차 DNS 정보를 얻고자 할 때 사용

---

암호화 하는 것은 multi thread로 돌아간다.

- 단방향 암호화(crypto)
  - 암호화는 가능하지만 복호화(해독)는 불가능하다.
  - 해시 기법(해시 함수)으로 가능하다.
- pbkdf2
  - 해시화 한다.

---

- fs

  - 파일 시스템에 접근하는 모듈
  - 파일/폴더 생성, 삭제, 읽기, 쓰기 가능
  - 웹 브라우저에서는 제한적이었으나 노드는 권한을 가지고 있음
  - 사용법

    ```
    const fs = require('fs').promise;

    fs.readFile('./readme.txt')
      .then((data) => {
        console.log(data);
        console.log(data.toString())
      })
      .catch((err) => {
        throw err
      })
    ```

---

- asyncOrderProcess : 비동기로 하되 순서를 지킬 수 있다.
- sync : 편하기는 하지만 서버에서 사용하면 문제가 생긴다.

---

<img src="./img/Screenshot 2024-05-08 at 9.20.39 PM.png"/>
- 버퍼
  - 일정한 크기로 모아두는 데이터
  - 버퍼링 : 버퍼에 데이터가 찰 때까지 모으는 작업

- 스트림
  - 데이터의 흐름
  - 일정한 크기로 나눠서 여러 번에 걸쳐서 처리
  - 버퍼(또는 청크)의 크기를 작게 만들어서 주기적으로 데이터를 전달
  - 스트리밍 : 일정한 크기의 데이터를 지속적으로 전달하는 작업
  - 버퍼 보다 효율적이다.(메모리도 적게 차지한다.)

---

- 기타 fs 메서드
  <img src="./img/Screenshot 2024-05-08 at 9.44.57 PM.png" />

---

스레드풀

- fs, crypto, zlib 모듈의 메서드를 실행할 때는 백그라운드에서 동시에 실행됨
  - 스레드풀이 동시에 처리해줌

---

예외 처리하기

- 노드는 싱글스레드이기 때문에 에러가 나지 않게하는 것이 매우 중요하다.
- 예외(exception): 처리하지 못한 에러 (js 언어에서는 에러와 예외를 같게 사용한다.)
  - 에러는 노드 스레드를 멈춘다.
  - 노드는 기본적으로 싱글 스레드라 스레드가 멈춘다는 것은 프로세스가 멈춘다는 것을 의미한다.
  - 고로, 에러 처리는 필수이다.

1. 기본적으로 try/catch 문으로 예외를 처리한다.

- 에러가 발생할 만한 곳을 try catch로 감싼다.

```
// try 부분에서 던진 에러를 catch가 잡는다.
// try/catch가 없다면 에러 때문에 서버에 에러가 떴겠지만, try/catch를 사용하여 에러 대신 콘손에 에러로그를 찍어 준다.

setInterval(() => {
  console.log('시작')

  try {
    throw new Error('서버를 고장내주마!')
  } catch (err) {
    console.error(err)
  }
}, 1000)
```

- 그렇다고 모든 코드를 try/catch로 감쌀 수 는 없으니 감싸지 않아도 되는 것을 알아 두자

  1. fs

  - if로만 콘솔로 찍어주자. 이렇게 해도 프로세스가 멈추지 않는다.

    ```
    const fs = require('fs')

    setInterval(() => {
      fs.unlink('./abcdefg.js', (err) => {
        if (err) {
          console.error(err)
        }
      })
    }, 1000)
    ```

  2. 프로미스 에러는 따로 처리해 주지 않아도 된다. (버전이 달라지면 동작이 바뀔 수 있다. => 그냥 catch 붙이는 습관 들이자.)

  - 경고가 뜰 뿐 에러가 발생하지는 않는다.

    - `unhandledPromiseRejectionWarning` : promise에 catch를 붙이지 않아서 발생한 에러이다.

    ```
    const fs = require('fs').promises;

    setInterval(() => {
      fs.unlink('./abcdefg.js')
    }, 1000);
    ```

  - 모든 경우에 try-catch를 붙이기 싫은 경우 처리 방법

  1. process 객체에 `uncaughtException` 이벤트를 달면 모든 에러가 여기로 간다.

  - 주의 할 점이 복구 코드를 아래의 콜백 함수 내에 넣으면 안 된다.

  ```
  process.on('uncaughtException', (err) => {
    console.error('예기치 못한 에러', err)
  })
  ```

---

프로세스 종료하기

맥/리눅스

```
$ lsof -i tcp:포트
$ kill -9 프로세스아이디

```

---

- 노드 프로젝트 시작 전 package.json 부터 만들고 시작함(`npm init`)

---

(개인적으로 신기했던 부분)

- 패키지 설치하는 법: `npm publish` 하면 남이 우리 npm을 `npm i 이름`으로 받아서 사용 가능하다.
- `npm unpublish --force` 하면 사라진다. (72시간 내에만 가능하다.)
- `npm info 이름` 명령어로 지워졌는지 정보가 있는지 확인해 볼 수 있다.

---

### package.jso n의 버전 올리기

`major.minor.patch`

- 예를 들어 `npm version patch` 하면 세번째 자리가 하나 올라간다.

- 그냥 `package.json`의 숫자를 바꿔도 되지만 위의 명령어 처럼하면 git commit도 된다.

---

### express

남이 미리 만들어 둔 서버
