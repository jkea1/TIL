# [Network] 쿠키(Cookie), 세션(Session) 그리고 JWT(JSONWebToken) - (1) Cookie & Session

### **쿠키**

쿠키는 브라우저 로컬(유저의 하드디스크 메모리)에 `key:value` 쌍으로 저장되는 작은 크기의 문자열 데이터이자 HTTP 프로토콜의 일부입니다. 유효시간 내에서는 브라우저가 종료되어도 계속 유지됩니다.

#### **쿠키의 생성과 저장 과정**

쿠키의 생성과 저장은 구현에 따라 다르지만 원리는 동일합니다. 쿠키는 주로 웹 서버에 의해 만들어집니다. 예시와 함께 살펴 봅시다. 예를 들어, 서버에서 `username=ea`, `userlevel=3` 이라는 2개의 쿠키를 브라우저에 저장하고 싶다고 가정해 볼게요.

1. `www.test.com` 서버는 브라우저의 요청이 들어오면, 클라이언트에 관한 정보를 토대로 각 쿠키를 `Set-Cookie` 헤더에 실어서 응답합니다.

```
// HTTP Request
GET /index.html HTTP/1.1
HOST: www.test.com
```

```
// HTTP Response
HTTP/1.1 200 OK
Content-Type: text/html
Set-Cookie: username=ea
Set-Cookie: userlevel=3
```

#

2. 브라우저는 서버로 받은 이 2개의 쿠키를 클라이언트의 하드디스크에 저장해둡니다. 브라우저의 Application 탭의 Cookie 디렉터리에서도 확인할 수 있습니다.

3. 이후 동일한 서버(`www.test.com`)로 요청을 할 때마다 `Cookie` 헤더에 이전에 서버로 부터 받았던 쿠키를 그대로 담아 보냅니다.

```
// HTTP 요청
GET /index.html HTTP/1.1
Host: www.test.com
Cookie: username=ea; userlevel=3
```

4. 서버는 브라우저로 부터 들어오는 요청에서 `username=ea`,`userlevel=3` 라는 쿠키를 읽어서 원하는 용도로 활용할 수 있습니다.

#### 쿠키 사용 예시

쿠키는 다양한 곳에서 사용됩니다. 사이트에 방문했을때 모든 쿠키를 허용하시겠습니까? 라는 팝업창을 자주 볼 수 있었을 겁니다.

#

쇼핑몰 사이트에서 여러 상품을 보기 위해 페이지를 이동하여도 장바구니의 상품은 계속 유지 되는 것도 쿠키에 장바구니 정보를 담아둔 덕분입니다.

#

그리고 로그인 정보를 저장하시겠습니까? 라는 문구도 자주 볼 수 있는데 아이디와 비밀번호를 저장하고 자동 로그인 되는 것도 쿠키를 사용 했기 때문입니다.

#

또한 광고 팝업창 하단에 "오늘 더 이상 이 창을 보지 않음" 이라는 체크 박스가 있습니다. 여기에 체크 하게 되면 서비스를 이용하는 동안 페이지를 이동하더라도 광고 팝업 창이 더이상 뜨지 않습니다. 이 또한 쿠키를 이용한 방식입니다.

#### 쿠키의 종류

쿠키에는 **세션 쿠키(임시 쿠키)**와 **영구 쿠키**가 있습니다.

**세션 쿠키(임시 쿠키)**는 웹 사이트를 방문할 때 브라우저 내의 서브 폴더에 생성되며, 사용자가 사이트를 떠나면 삭제되는 쿠키입니다. 그러나 **영구 쿠키**는 브라우저 서브 폴더에 그래로 남아 해당 웹 사이트에서 활동한 내역을 저장하고 있습니다. 저장 기간은 보통 브라우저 설정에서 변경할 수 있습니다. 지정된 만료일이 되면 디스크에서 쿠키가 제거됩니다.

#

예시와 함께 쿠키 종류를 살펴 보면, 브라우저를 종료하고 재 접속 시에도 로그인이 유지되어 있으며, 장바구니 정보도 보존되어 있다면 그건 영구 쿠키를 사용했을 것이고, 브라우저를 종료하고 재 접속 시에 광고 팝업이 또 다시 뜨면서 "오늘 더 이상 이 창을 보지 않음" 체크 박스에 체크하게 한다면 세션 쿠키를 사용 한 것으로 브라우저를 닫으면 세션 쿠키는 삭제 되기 때문에 다시 쿠키를 생성해 줘야 광고 팝업창이 뜨지 않습니다.

#### 자바스크립트로 쿠키 다루기

쿠키는 주로 웹 서버에 의해 만들어 진다고 해서 브라우저에서 쿠키에 접근을 못하는 것은 아닙니다. `document.cookie` 프로퍼티를 이용하면 쿠키를 `create`, `delete`, `read` 할 수 있습니다.

#

`document.cookie`는 `name=value` 쌍으로 구성되어있고, 각 쌍은 `;`로 구분합니다.

```js
// read
let cookie = document.cookie // cookieName1=value1; cookieName2=value2

// create
// name이 user이고, value가 John인 쿠키 추가
// 속성값으로 path와 expires를 설정해서 추가
// 속성값은 쿠키 스트링에 저장되지 않고 속성 정보에 저장된다.

document.cookie = 'user=John; path=/; expires=Tue, 19 Jan 2038 03:14:07 GMT'

// delete
// 만료 기간을 과거로 바꾸어 버리면 된다. 단, 쿠키 요소를 삭제할때는 반드시 path를 맞춰야 한다.
// 혹은 max-age를 사용할 수 있다.
// max-age는 expires 속성의 대안으로 동일하게 쿠키 만료 기간을 설정할 수 있게 해준다.
// 1시간 뒤에 쿠키가 삭제된다.
document.cookie = 'max-age=3600'

// 만료 기간을 0으로 지정하고 쿠키를 바로 삭제한다.
document.cookie = 'max-age=0'
```

### **세션**

세션은 브라우저가 종료되거나 서버에서 해당 세션을 삭제하면 삭제 할 수 있기 때문에 쿠키보다 보안성이 좋습니다. 또한 서버에서 데이터를 저장하므로 서버 용량이 허용하는 한 제한 없이 데이터를 저장할 수 있 수 있다는 장점이 있습니다. 하지만 양면적으로 이로 인해 서버의 부하가 커질 수 있습니다.

### **세션 vs 세션 스토리지 ( 세션 예시와 세션 스토리지 코드 예시 첨부하자. )**

**세션**

서버 측에서 관리되는 사용자의 상태나 데이터를 의미합니다.

**세션 스토리지**

웹 스토리지 객체인 local storage 와 session storage 중 하나로 브라우저 내에서 탭 또는 창 별로 독립적으로 데이터를 저장하는 메커니즘입니다. 브라우저내에 key-value 쌍을 저장할 수 있게 해줍니다. localStorage와 sessionStorage를 사용하면 페이지를 새로고침해도 데이터를 보존할 수 있고 localStorage를 사용할 경우 심지어 브라우저를 다시 실행해도 데이터가 사라지지 않고 남아있습니다.

### 쿠키를 사용하면 브라우저에 데이터를 저장할 수 있는데 , 왜 웹 스토리지 객체를 사용해 데이터를 저장하는 걸까? (이건 따로 글 빼서 써야겠다.)

1.  용량 제한

쿠키는 일반적으로 도메인당 약 4KB의 데이터만 저장할 수 있습니다. 로컬 스토리지와 세션 스토리지는 일반적으로 도메인당 약 5KB에서 10KB까지 데이터를 저장 할 수 있습니다.

2.  네트워크 트래픽

쿠키는 매번 서버와의 요청과 응답 시마다 함께 전송됩니다. 이는 불필요한 네트워크 트래픽을 증가시키고 성능에 영향을 줄 수 있습니다. 반면에 로컬 스로리지와 세션 스토리지는 클라이언트 측i에만 저장되며, 서버로 전송되지 않으므로 네트워크 트래픽에 영향을 주지 않습니다.

3.  보안 문제

쿠키는 특히 세션 관리에 자주 사용되며(잉?), 이를 악용한 세션 하이재킹 공격이 있을 수 있습니다. HTTPS를 사용하여 쿠키를 암호화하거나 HttpOnly 속성을 설정하여 자바스크립트에서 접근할 수 없도록 해야 합니다.

로컬 스토리지와 세션 스토리지는 클라이언트 측에 저장되며, 쿠키와 달리 자동으로 서버로 전송되지 않기 때문에 이러한 종류의 공격에 덜 취약합니다. 그러나 여전히 자바스크립트에서 접근할 수 있으므로 XSS 공격에 주의해야 합니다.

4.  데이터 만료

쿠키의 key와 value는 문자열 형태로 저장되기 때문에 데이터 형식의 관리가 까다로울 수 있습니다. 로컬 스토리지와 세션

쿠키와 다르게 웹 스토리지 객체는 네트워크 요청 시 서버로 전송되지 않습니다. (쿠키는 네트워크 요청 시 서버로 전달되나?) 이 때문에 쿠키보다 더 많은 자료를 보관할 수 있습니다. (2MB 혹은 그 이상) 또한 쿠키와 다르게 서버가

### 🦋 참고 자료

[로그인방식에 대한 고찰(session ID, Token방식)](https://velog.io/@chhw130/%EB%A1%9C%EA%B7%B8%EC%9D%B8%EB%B0%A9%EC%8B%9D%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EC%B0%B0session-ID-Token%EB%B0%A9%EC%8B%9D)

[localStorage와 sessionStorage](https://ko.javascript.info/localstorage)

[HTTP 프로토콜](https://docs.tosspayments.com/resources/glossary/http-protocol#http-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)

[자바스크립트로 쿠키 다루기](https://inpa.tistory.com/entry/JS-%F0%9F%93%9A-%EC%BF%A0%ED%82%A4Cookie-%EB%8B%A4%EB%A3%A8%EA%B8%B0)

[쿠키와 document.cookie](https://ko.javascript.info/cookie)

[쿠키](https://www.oss.kr/info_techtip/show/236f8b36-d60b-42ce-a486-c70f0aa51a35)

[WEB 쿠키(cookie), 세션(session)에 대해서](https://velog.io/@reasonz/2022.04.06-WEB-%EC%BF%A0%ED%82%A4cookie-%EC%84%B8%EC%85%98session%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C)

[쿠키 1부: HTTP로 설명하는 쿠키(cookie)](https://www.daleseo.com/http-cookies/)
